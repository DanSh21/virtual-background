{"version":3,"sources":["components/SourcePlayer.tsx","components/PlayerCard.tsx","helpers/sourceHelper.ts","hooks/useImageThumbnail.ts","components/TumbnailButton.tsx","components/VideoButton.tsx","components/SourceSelectionCard.tsx","hooks/useCamera.ts","hooks/useStats.ts","hooks/useVideoResize.ts","components/VideoControl.tsx","components/VideoPlayer.tsx","hooks/useBodyPix.ts","hooks/useTFLite.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["makeStyles","theme","createStyles","root","width","overflow","imageUrls","map","imageName","process","videoName","useImageThumbnail","padding","minWidth","height","marginRight","spacing","marginBottom","border","alignItems","transitionProperty","transitionDuration","transitions","duration","shorter","transitionTimingFunction","easing","easeInOut","transform","active","borderColor","palette","primary","main","scalableContent","margin","borderRadius","image","objectFit","icon","position","bottom","right","color","common","white","useCamera","videoRef","useRef","useEffect","a","constraints","video","navigator","mediaDevices","getUserMedia","stream","current","srcObject","console","error","alert","playVideoFromCamera","useStats","useState","fps","setFps","durations","setDurations","previousTimeRef","beginTimeRef","durationsRef","eventCount","frameCountRef","beginFrame","useCallback","Date","now","addFrameEvent","time","endFrame","useVideoResize","videoWidth","setVideoWidth","videoHeight","setVideoHeight","log","addEventListener","handleVideoResize","removeEventListener","VideoControl","props","className","clsx","isActivated","onClick","children","VideoPlayer","canvasRef","maskCanvasRef","imageRef","isVideoPlaying","setVideoPlaying","background","setBackground","inferenceDuration","postProcessingDuration","ctx","getContext","maskCtx","mask","ImageData","videoPixelCount","imageWidth","naturalWidth","imageHeight","naturalHeight","imageScale","Math","max","animationRequestId","shouldDrawBackground","drawBackground","cancelAnimationFrame","bodyPixNeuralNetwork","segmentPerson","segmentation","i","data","putImageData","globalCompositeOperation","filter","drawImage","requestAnimationFrame","round","ref","autoPlay","playsInline","controls","hidden","onLoadedData","onAbort","src","alt","useBodyPix","setBodyPixNeuralNetwork","tf","bodyPix","loadBodyPix","useTFLite","createTFLiteModule","tfliteModule","fetch","lightModelResponse","arrayBuffer","lightModel","byteLength","fullModelResponse","fullModel","modelBufferOffset","_getModelBufferMemoryOffset","HEAPU8","set","Uint8Array","_loadModel","_getInputMemoryOffset","_getInputHeight","_getInputWidth","_getInputChannelCount","_getOutputMemoryOffset","_getOutputHeight","_getOutputWidth","_getOutputChannelCount","start","inferenceResult","_runInference","loadTFLite","useStyles","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","CssBaseline","document","getElementById"],"mappings":"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","file":"static/js/main.b7e4f2fb.chunk.js","sourcesContent":["import { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\n\ntype SourcePlayerProps = {\n  sourceUrl: string\n}\n\nfunction SourcePlayer(props: SourcePlayerProps) {\n  const classes = useStyles()\n\n  return <img className={classes.root} src={props.sourceUrl} alt=\"\" />\n}\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      width: '100%',\n    },\n  })\n)\n\nexport default SourcePlayer\n","import Grid from '@material-ui/core/Grid'\nimport Paper from '@material-ui/core/Paper'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport SourcePlayer from './SourcePlayer'\n\ntype PlayerCardProps = {\n  sourceUrl: string\n}\n\nfunction PlayerCard(props: PlayerCardProps) {\n  const classes = useStyles()\n\n  return (\n    <Paper className={classes.root}>\n      <Grid container>\n        <Grid container item xs={6}>\n          <SourcePlayer sourceUrl={props.sourceUrl} />\n        </Grid>\n      </Grid>\n    </Paper>\n  )\n}\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      overflow: 'hidden',\n    },\n  })\n)\n\nexport default PlayerCard\n","export const imageUrls = [\n  'girl-919048_1280',\n  'doctor-5871743_640',\n  'woman-5883428_1280',\n].map((imageName) => `${process.env.PUBLIC_URL}/images/${imageName}.jpg`)\n\nexport const videoUrls = ['1615284309', '1814594990', '1992432523'].map(\n  (videoName) => `${process.env.PUBLIC_URL}/videos/${videoName}.mp4`\n)\n","import { useEffect, useState } from 'react'\nimport { getThumbnailBlob } from '../helpers/thumbnailHelper'\n\n/**\n * Returns an image thumbnail URL and a function to revoke it.\n */\nfunction useImageThumbnail(imageUrl: string): [string | null, () => void] {\n  const [thumbnailUrl, setThumbnailUrl] = useState<string | null>(null)\n\n  useEffect(() => {\n    const image = new Image()\n    image.src = imageUrl\n    image.onload = async () => {\n      const blob = await getThumbnailBlob(\n        image,\n        image.naturalWidth,\n        image.naturalHeight\n      )\n      setThumbnailUrl(URL.createObjectURL(blob))\n    }\n  }, [imageUrl])\n\n  return [thumbnailUrl, () => URL.revokeObjectURL(thumbnailUrl!)]\n}\n\nexport default useImageThumbnail\n","import Button from '@material-ui/core/Button'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport Skeleton from '@material-ui/lab/Skeleton'\nimport clsx from 'clsx'\n\ntype ThumbnailButtonProps = {\n  thumbnailUrl: string | null\n  isActive: boolean\n  children?: React.ReactNode\n  onClick: () => void\n  onLoad?: () => void\n}\n\nfunction ThumbnailButton(props: ThumbnailButtonProps) {\n  const classes = useStyles()\n\n  return (\n    <Button\n      key={props.thumbnailUrl}\n      className={clsx(\n        classes.root,\n        props.thumbnailUrl && props.isActive && classes.active\n      )}\n      disabled={!props.thumbnailUrl}\n      onClick={props.onClick}\n    >\n      {props.thumbnailUrl ? (\n        <img\n          className={clsx(classes.scalableContent, classes.image)}\n          src={props.thumbnailUrl}\n          alt=\"\"\n          onLoad={props.onLoad}\n        />\n      ) : (\n        <Skeleton className={classes.scalableContent} variant=\"rect\" />\n      )}\n      {props.children}\n    </Button>\n  )\n}\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      padding: 0,\n      minWidth: 58,\n      height: 58,\n      width: 58,\n      marginRight: theme.spacing(1),\n      marginBottom: theme.spacing(1),\n      border: '2px solid transparent',\n      alignItems: 'stretch',\n      transitionProperty: 'transform, border-color',\n      transitionDuration: `${theme.transitions.duration.shorter}ms`,\n      transitionTimingFunction: theme.transitions.easing.easeInOut,\n\n      '&:hover': {\n        transform: 'scale(1.125)',\n      },\n    },\n    active: {\n      borderColor: theme.palette.primary.main,\n      transform: 'scale(1.125)',\n    },\n    scalableContent: {\n      // Fix rendering issues with border when scaled\n      width: 'calc(100% + 2px)',\n      height: 'calc(100% + 2px)',\n      margin: -1,\n      borderRadius: 4,\n    },\n    image: {\n      objectFit: 'cover',\n    },\n  })\n)\n\nexport default ThumbnailButton\n","import { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport PlayCircleOutlineIcon from '@material-ui/icons/PlayCircleOutline'\nimport useVideoThumbnail from '../hooks/useVideoThumbnail'\nimport ThumbnailButton from './TumbnailButton'\n\ntype VideoButtonProps = {\n  videoUrl: string\n  isActive: boolean\n  onClick: () => void\n}\n\nfunction VideoButton(props: VideoButtonProps) {\n  const classes = useStyles()\n  const [thumbnailUrl, revokeThumbnailUrl] = useVideoThumbnail(props.videoUrl)\n\n  return (\n    <ThumbnailButton\n      thumbnailUrl={thumbnailUrl}\n      isActive={props.isActive}\n      onClick={props.onClick}\n      onLoad={revokeThumbnailUrl}\n    >\n      <PlayCircleOutlineIcon className={classes.icon} />\n    </ThumbnailButton>\n  )\n}\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    icon: {\n      position: 'absolute',\n      bottom: 0,\n      right: 0,\n      color: theme.palette.common.white,\n    },\n  })\n)\n\nexport default VideoButton\n","import Card from '@material-ui/core/Card'\nimport CardContent from '@material-ui/core/CardContent'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport Typography from '@material-ui/core/Typography'\nimport { imageUrls, videoUrls } from '../helpers/sourceHelper'\nimport ImageButton from './ImageButton'\nimport VideoButton from './VideoButton'\n\n// TODO Handle cameras and videos\ntype SourceSelectionCardProps = {\n  sourceUrl: string\n  onSourceUrlChange: (sourceUrl: string) => void\n}\n\nfunction SourceSelectionCard(props: SourceSelectionCardProps) {\n  const classes = useStyles()\n\n  return (\n    <Card className={classes.root}>\n      <CardContent>\n        <Typography gutterBottom variant=\"h5\" component=\"h2\">\n          Source\n        </Typography>\n        {imageUrls.map((imageUrl) => (\n          <ImageButton\n            key={imageUrl}\n            imageUrl={imageUrl}\n            isActive={imageUrl === props.sourceUrl}\n            onClick={() => props.onSourceUrlChange(imageUrl)}\n          />\n        ))}\n        {videoUrls.map((videoUrl) => (\n          <VideoButton\n            key={videoUrl}\n            videoUrl={videoUrl}\n            isActive={videoUrl === props.sourceUrl}\n            onClick={() => props.onSourceUrlChange(videoUrl)}\n          />\n        ))}\n      </CardContent>\n    </Card>\n  )\n}\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      height: '100%',\n    },\n  })\n)\n\nexport default SourceSelectionCard\n","import { useEffect, useRef } from 'react'\n\nfunction useCamera() {\n  const videoRef = useRef<HTMLVideoElement>(null!)\n\n  useEffect(() => {\n    async function playVideoFromCamera() {\n      try {\n        const constraints = { video: true }\n        const stream = await navigator.mediaDevices.getUserMedia(constraints)\n        videoRef.current.srcObject = stream\n      } catch (error) {\n        console.error('Error opening video camera.', error)\n        alert(`Error opening video camera. ${error}`)\n      }\n    }\n\n    playVideoFromCamera()\n  }, [])\n\n  return videoRef\n}\n\nexport default useCamera\n","import { useCallback, useRef, useState } from 'react'\n\nfunction useStats() {\n  const [fps, setFps] = useState(0)\n  const [durations, setDurations] = useState<number[]>([])\n  const previousTimeRef = useRef(0)\n  const beginTimeRef = useRef(0)\n  const durationsRef = useRef<number[]>([])\n  const eventCount = useRef(0)\n  const frameCountRef = useRef(0)\n\n  // The useCallbacks below are required to prevent infinite loop\n  // when the functions are called inside useEffect\n\n  const beginFrame = useCallback(() => {\n    beginTimeRef.current = Date.now()\n  }, [])\n\n  const addFrameEvent = useCallback(() => {\n    const time = Date.now()\n    durationsRef.current[eventCount.current] = time - beginTimeRef.current\n    beginTimeRef.current = time\n    eventCount.current++\n  }, [])\n\n  const endFrame = useCallback(() => {\n    const time = Date.now()\n    durationsRef.current[eventCount.current] = time - beginTimeRef.current\n    frameCountRef.current++\n    if (time >= previousTimeRef.current + 1000) {\n      setFps((frameCountRef.current * 1000) / (time - previousTimeRef.current))\n      setDurations(durationsRef.current)\n      previousTimeRef.current = time\n      frameCountRef.current = 0\n    }\n    eventCount.current = 0\n  }, [])\n\n  return { fps, durations, beginFrame, addFrameEvent, endFrame }\n}\n\nexport default useStats\n","import { RefObject, useEffect, useState } from 'react'\n\nfunction useVideoResize(videoRef: RefObject<HTMLVideoElement>) {\n  const [videoWidth, setVideoWidth] = useState(0)\n  const [videoHeight, setVideoHeight] = useState(0)\n\n  useEffect(() => {\n    if (!videoRef.current) {\n      return\n    }\n    const video = videoRef.current\n\n    function handleVideoResize() {\n      console.log('Video was resized')\n      setVideoWidth(video.videoWidth)\n      setVideoHeight(video.videoHeight)\n    }\n\n    console.log('Listening for video resize')\n    video.addEventListener('resize', handleVideoResize)\n\n    return () => {\n      video.removeEventListener('resize', handleVideoResize)\n    }\n  }, [videoRef])\n\n  return { videoWidth, videoHeight }\n}\n\nexport default useVideoResize\n","import clsx from 'clsx'\nimport './VideoControl.css'\n\ntype VideoControlProps = {\n  children: React.ReactNode\n  isActivated?: boolean\n  onClick: () => void\n}\n\nfunction VideoControl(props: VideoControlProps) {\n  return (\n    <button\n      className={clsx(\n        'VideoControl',\n        props.isActivated && 'VideoControl-activated'\n      )}\n      onClick={props.onClick}\n    >\n      {props.children}\n    </button>\n  )\n}\n\nexport default VideoControl\n","import BlockIcon from '@material-ui/icons/Block'\nimport BlurOnIcon from '@material-ui/icons/BlurOn'\nimport ImageIcon from '@material-ui/icons/Image'\nimport { BodyPix } from '@tensorflow-models/body-pix'\nimport { useEffect, useRef, useState } from 'react'\nimport useCamera from '../hooks/useCamera'\nimport useStats from '../hooks/useStats'\nimport useVideoResize from '../hooks/useVideoResize'\nimport VideoControl from './VideoControl'\nimport './VideoPlayer.css'\n\ntype VideoPlayerProps = {\n  // BodyPix must be loaded outside this component to prevent\n  // GPU memory issues with Create React App HMR\n  bodyPixNeuralNetwork: BodyPix\n}\n\ntype Background = 'none' | 'blur' | 'image'\n\n// FIXME No background icon is displayed while initializing camera\nfunction VideoPlayer(props: VideoPlayerProps) {\n  const canvasRef = useRef<HTMLCanvasElement>(null!)\n  const maskCanvasRef = useRef<HTMLCanvasElement>(null!)\n  const imageRef = useRef<HTMLImageElement>(null!)\n  const videoRef = useCamera()\n  const { videoWidth, videoHeight } = useVideoResize(videoRef)\n  const [isVideoPlaying, setVideoPlaying] = useState(false)\n  const [background, setBackground] = useState<Background>('none')\n  const {\n    fps,\n    durations: [inferenceDuration, postProcessingDuration],\n    beginFrame,\n    addFrameEvent,\n    endFrame,\n  } = useStats()\n\n  useEffect(() => {\n    if (!isVideoPlaying) {\n      return\n    }\n\n    const ctx = canvasRef.current.getContext('2d')!\n    const maskCtx = maskCanvasRef.current.getContext('2d')!\n    const mask = new ImageData(videoWidth, videoHeight)\n    const videoPixelCount = videoWidth * videoHeight\n\n    let imageWidth = imageRef.current.naturalWidth\n    let imageHeight = imageRef.current.naturalHeight\n    const imageScale = Math.max(\n      1,\n      videoWidth / imageWidth,\n      videoHeight / imageHeight\n    )\n    imageWidth *= imageScale\n    imageHeight *= imageScale\n\n    // Required to stop looping in useEffect in development mode\n    let shouldDrawBackground = true\n\n    let animationRequestId: number\n\n    async function drawBackground() {\n      if (!shouldDrawBackground) {\n        return\n      }\n\n      beginFrame()\n      if (background !== 'none') {\n        const segmentation = await props.bodyPixNeuralNetwork.segmentPerson(\n          videoRef.current\n        )\n        for (let i = 0; i < videoPixelCount; i++) {\n          // Set only the alpha component of each pixel\n          mask.data[i * 4 + 3] = segmentation.data[i] ? 255 : 0\n        }\n        maskCtx.putImageData(mask, 0, 0)\n      }\n      addFrameEvent()\n      if (background === 'blur') {\n        ctx.globalCompositeOperation = 'copy'\n        ctx.filter = 'blur(8px)' // FIXME Does not work on Safari\n        ctx.drawImage(maskCanvasRef.current, 0, 0)\n        ctx.globalCompositeOperation = 'source-out'\n        ctx.drawImage(videoRef.current, 0, 0)\n        ctx.globalCompositeOperation = 'destination-over'\n        ctx.filter = 'none'\n      } else if (background === 'image') {\n        ctx.globalCompositeOperation = 'copy'\n        ctx.filter = 'blur(2px)' // FIXME Does not work on Safari\n        ctx.drawImage(maskCanvasRef.current, 0, 0)\n        ctx.globalCompositeOperation = 'source-out'\n        ctx.filter = 'none'\n        ctx.drawImage(imageRef.current, 0, 0, imageWidth, imageHeight)\n        ctx.globalCompositeOperation = 'destination-over'\n      } else {\n        ctx.globalCompositeOperation = 'source-over'\n      }\n      ctx.drawImage(videoRef.current, 0, 0)\n      endFrame()\n\n      animationRequestId = requestAnimationFrame(drawBackground)\n    }\n\n    drawBackground()\n    console.log('Animation started:', background)\n\n    return () => {\n      shouldDrawBackground = false\n      cancelAnimationFrame(animationRequestId)\n      console.log('Animation stopped:', background)\n    }\n  }, [\n    props.bodyPixNeuralNetwork,\n    videoRef,\n    background,\n    videoWidth,\n    videoHeight,\n    isVideoPlaying,\n    beginFrame,\n    addFrameEvent,\n    endFrame,\n  ])\n\n  return (\n    <div className=\"VideoPlayer\">\n      <div className=\"VideoPlayer-root\">\n        <div className=\"VideoPlayer-stats\">\n          <span>{Math.round(fps)} fps</span> (\n          <span>inference {inferenceDuration}ms</span>,{' '}\n          <span>post-processing {postProcessingDuration}ms</span>)\n        </div>\n        <video\n          ref={videoRef}\n          width={videoWidth}\n          height={videoHeight}\n          autoPlay\n          playsInline\n          controls={false}\n          hidden\n          onLoadedData={() => setVideoPlaying(true)}\n          onAbort={() => setVideoPlaying(false)}\n        ></video>\n        <img\n          ref={imageRef}\n          src={`${process.env.PUBLIC_URL}/backgrounds/trees-4830285_640.jpg`}\n          alt=\"\"\n          hidden\n        ></img>\n        <canvas\n          ref={maskCanvasRef}\n          width={videoWidth}\n          height={videoHeight}\n          hidden\n        ></canvas>\n        <canvas\n          ref={canvasRef}\n          className=\"VideoPlayer-video\"\n          width={videoWidth}\n          height={videoHeight}\n        ></canvas>\n        <div className=\"VideoPlayer-controls\">\n          <VideoControl\n            isActivated={background === 'none'}\n            onClick={() => setBackground('none')}\n          >\n            <BlockIcon />\n          </VideoControl>\n          <VideoControl\n            isActivated={background === 'blur'}\n            onClick={() => setBackground('blur')}\n          >\n            <BlurOnIcon />\n          </VideoControl>\n          <VideoControl\n            isActivated={background === 'image'}\n            onClick={() => setBackground('image')}\n          >\n            <ImageIcon />\n          </VideoControl>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default VideoPlayer\n","import * as bodyPix from '@tensorflow-models/body-pix'\nimport * as tf from '@tensorflow/tfjs'\nimport { useEffect, useState } from 'react'\n\nfunction useBodyPix() {\n  const [\n    bodyPixNeuralNetwork,\n    setBodyPixNeuralNetwork,\n  ] = useState<bodyPix.BodyPix | null>(null)\n\n  useEffect(() => {\n    async function loadBodyPix() {\n      console.log('Loading TensorFlow.js and BodyPix segmentation model')\n      await tf.ready()\n      setBodyPixNeuralNetwork(await bodyPix.load())\n      console.log('TensorFlow.js and BodyPix loaded')\n    }\n\n    loadBodyPix()\n  }, [])\n\n  return bodyPixNeuralNetwork\n}\n\nexport default useBodyPix\n","import { useEffect } from 'react'\n\ndeclare function createTFLiteModule(): Promise<TFLiteModule>\n\ninterface TFLiteModule extends EmscriptenModule {\n  _getModelBufferMemoryOffset(): number\n  _getInputMemoryOffset(): number\n  _getInputHeight(): number\n  _getInputWidth(): number\n  _getInputChannelCount(): number\n  _getOutputMemoryOffset(): number\n  _getOutputHeight(): number\n  _getOutputWidth(): number\n  _getOutputChannelCount(): number\n  _loadModel(bufferSize: number): number\n  _runInference(): number\n}\n\nfunction useTFLite() {\n  useEffect(() => {\n    async function loadTFLite() {\n      // TODO Fetch every resources in parallel\n      // TODO Load full or light model depending on the environment\n      // TODO Detect WASM features to handle SIMD and multithreading\n      const tfliteModule = await createTFLiteModule()\n      const lightModelResponse = await fetch(\n        `${process.env.PUBLIC_URL}/models/segm_lite_v681.tflite`\n      )\n      const lightModel = await lightModelResponse.arrayBuffer()\n      console.log('Lite model buffer size:', lightModel.byteLength)\n\n      const fullModelResponse = await fetch(\n        `${process.env.PUBLIC_URL}/models/segm_full_v679.tflite`\n      )\n      const fullModel = await fullModelResponse.arrayBuffer()\n      console.log('Full model buffer size:', fullModel.byteLength)\n\n      const modelBufferOffset = tfliteModule._getModelBufferMemoryOffset()\n      console.log('Model buffer memory offset:', modelBufferOffset)\n      console.log('Loading light model buffer...')\n      tfliteModule.HEAPU8.set(new Uint8Array(lightModel), modelBufferOffset)\n      console.log(\n        '_loadModel result:',\n        tfliteModule._loadModel(lightModel.byteLength)\n      )\n\n      console.log('Input memory offset:', tfliteModule._getInputMemoryOffset())\n      console.log('Input height:', tfliteModule._getInputHeight())\n      console.log('Input width:', tfliteModule._getInputWidth())\n      console.log('Input channels:', tfliteModule._getInputChannelCount())\n\n      console.log(\n        'Output memory offset:',\n        tfliteModule._getOutputMemoryOffset()\n      )\n      console.log('Output height:', tfliteModule._getOutputHeight())\n      console.log('Output width:', tfliteModule._getOutputWidth())\n      console.log('Output channels:', tfliteModule._getOutputChannelCount())\n\n      // TODO Move inference to the real-time render loop\n      const start = Date.now()\n      const inferenceResult = tfliteModule._runInference()\n      const inferenceDuration = Date.now() - start\n      console.log(\n        `_runInference result: ${inferenceResult} (${inferenceDuration}ms)`\n      )\n    }\n\n    loadTFLite()\n  }, [])\n}\n\nexport default useTFLite\n","import Grid from '@material-ui/core/Grid'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { useState } from 'react'\nimport PlayerCard from './components/PlayerCard'\nimport SourceSelectionCard from './components/SourceSelectionCard'\nimport VideoPlayer from './components/VideoPlayer'\nimport { imageUrls } from './helpers/sourceHelper'\nimport useBodyPix from './hooks/useBodyPix'\nimport useTFLite from './hooks/useTFLite'\n\nfunction App() {\n  // TODO Inititialize the camera and segmentation models in parallel\n\n  // Loads BodyPix only once outside of VideoPlayer component to prevent\n  // GPU memory issues with Create React App HMR\n  const bodyPixNeuralNetwork = useBodyPix()\n\n  useTFLite()\n\n  const classes = useStyles()\n  const [sourceUrl, setSourceUrl] = useState<string>(imageUrls[0])\n\n  return process.env.NODE_ENV === 'development' ? (\n    <Grid className={classes.root} container spacing={2}>\n      <Grid item xs={8}>\n        <PlayerCard sourceUrl={sourceUrl} />\n      </Grid>\n      <Grid item xs={4}>\n        <SourceSelectionCard\n          sourceUrl={sourceUrl}\n          onSourceUrlChange={setSourceUrl}\n        />\n      </Grid>\n    </Grid>\n  ) : (\n    bodyPixNeuralNetwork && (\n      <VideoPlayer bodyPixNeuralNetwork={bodyPixNeuralNetwork} />\n    )\n  )\n}\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      padding: theme.spacing(2),\n    },\n  })\n)\n\nexport default App\n","import { ReportHandler } from 'web-vitals'\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry)\n      getFID(onPerfEntry)\n      getFCP(onPerfEntry)\n      getLCP(onPerfEntry)\n      getTTFB(onPerfEntry)\n    })\n  }\n}\n\nexport default reportWebVitals\n","import CssBaseline from '@material-ui/core/CssBaseline'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\nimport reportWebVitals from './reportWebVitals'\n\nReactDOM.render(\n  <React.StrictMode>\n    <CssBaseline />\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}