(this["webpackJsonpvirtual-background"]=this["webpackJsonpvirtual-background"]||[]).push([[0],{260:function(e,t,n){},261:function(e,t,n){},266:function(e,t){},267:function(e,t){},275:function(e,t){},278:function(e,t){},279:function(e,t){},280:function(e,t,n){},281:function(e,t,n){"use strict";n.r(t);var r=n(45),o=n(39),c=n.n(o),a=n(232),u=n.n(a),i=n(4),s=n.n(i),l=n(11),f=n(6);var d=function(){var e=Object(o.useRef)(null);return Object(o.useEffect)((function(){function t(){return(t=Object(l.a)(s.a.mark((function t(){var n,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n={video:!0},t.next=4,navigator.mediaDevices.getUserMedia(n);case 4:r=t.sent,e.current.srcObject=r,t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("Error opening video camera.",t.t0),alert("Error opening video camera. ".concat(t.t0));case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]),e};var b=function(){var e=Object(o.useState)(0),t=Object(f.a)(e,2),n=t[0],r=t[1],c=Object(o.useState)([]),a=Object(f.a)(c,2),u=a[0],i=a[1],s=Object(o.useRef)(0),l=Object(o.useRef)(0),d=Object(o.useRef)([]),b=Object(o.useRef)(0),g=Object(o.useRef)(0);return{fps:n,durations:u,beginFrame:Object(o.useCallback)((function(){l.current=Date.now()}),[]),addFrameEvent:Object(o.useCallback)((function(){var e=Date.now();d.current[b.current]=e-l.current,l.current=e,b.current++}),[]),endFrame:Object(o.useCallback)((function(){var e=Date.now();d.current[b.current]=e-l.current,g.current++,e>=s.current+1e3&&(r(1e3*g.current/(e-s.current)),i(d.current),s.current=e,g.current=0),b.current=0}),[])}};var g=function(e){var t=Object(o.useState)(0),n=Object(f.a)(t,2),r=n[0],c=n[1],a=Object(o.useState)(0),u=Object(f.a)(a,2),i=u[0],s=u[1];return Object(o.useEffect)((function(){if(e.current){var t=e.current;return console.log("Listening for video resize"),t.addEventListener("resize",n),function(){t.removeEventListener("resize",n)}}function n(){console.log("Video was resized"),c(t.videoWidth),s(t.videoHeight)}}),[e]),{videoWidth:r,videoHeight:i}};n(260);var p=function(e){return Object(r.jsx)("button",{className:"VideoControl ".concat(e.isActivated?"VideoControl-activated":""),onClick:e.onClick,children:e.iconName})};n(261);var j=function(e){var t=Object(o.useRef)(null),n=Object(o.useRef)(null),c=Object(o.useRef)(null),a=d(),u=g(a),i=u.videoWidth,j=u.videoHeight,m=Object(o.useState)(!1),O=Object(f.a)(m,2),h=O[0],v=O[1],x=Object(o.useState)("none"),y=Object(f.a)(x,2),w=y[0],k=y[1],C=b(),_=C.fps,I=Object(f.a)(C.durations,2),F=I[0],N=I[1],P=C.beginFrame,E=C.addFrameEvent,L=C.endFrame;return Object(o.useEffect)((function(){if(h){var r=t.current.getContext("2d"),o=n.current.getContext("2d"),u=new ImageData(i,j),f=i*j,d=c.current.naturalWidth,b=c.current.naturalHeight,g=Math.max(1,i/d,j/b);d*=g,b*=g;var p,m=!0;return O(),console.log("Animation started:",w),function(){m=!1,cancelAnimationFrame(p),console.log("Animation stopped:",w)}}function O(){return v.apply(this,arguments)}function v(){return(v=Object(l.a)(s.a.mark((function t(){var i,l;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(m){t.next=2;break}return t.abrupt("return");case 2:if(P(),"none"===w){t.next=9;break}return t.next=6,e.bodyPixNeuralNetwork.segmentPerson(a.current);case 6:for(i=t.sent,l=0;l<f;l++)u.data[4*l+3]=i.data[l]?255:0;o.putImageData(u,0,0);case 9:E(),"blur"===w?(r.globalCompositeOperation="copy",r.filter="blur(8px)",r.drawImage(n.current,0,0),r.globalCompositeOperation="source-out",r.drawImage(a.current,0,0),r.globalCompositeOperation="destination-over",r.filter="none"):"image"===w?(r.globalCompositeOperation="copy",r.filter="blur(2px)",r.drawImage(n.current,0,0),r.globalCompositeOperation="source-out",r.filter="none",r.drawImage(c.current,0,0,d,b),r.globalCompositeOperation="destination-over"):r.globalCompositeOperation="source-over",r.drawImage(a.current,0,0),L(),p=requestAnimationFrame(O);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}}),[e.bodyPixNeuralNetwork,a,w,i,j,h,P,E,L]),Object(r.jsxs)("div",{className:"VideoPlayer",children:[Object(r.jsxs)("div",{className:"VideoPlayer-stats",children:[Object(r.jsxs)("span",{children:[Math.round(_)," fps"]})," (",Object(r.jsxs)("span",{children:["inference ",F,"ms"]}),","," ",Object(r.jsxs)("span",{children:["post-processing ",N,"ms"]}),")"]}),Object(r.jsx)("video",{ref:a,width:i,height:j,autoPlay:!0,playsInline:!0,controls:!1,hidden:!0,onLoadedData:function(){return v(!0)},onAbort:function(){return v(!1)}}),Object(r.jsx)("img",{ref:c,src:"".concat("/virtual-background","/backgrounds/trees-4830285_640.jpg"),alt:"",hidden:!0}),Object(r.jsx)("canvas",{ref:n,width:i,height:j,hidden:!0}),Object(r.jsx)("canvas",{ref:t,className:"VideoPlayer-video",width:i,height:j}),Object(r.jsxs)("div",{className:"VideoPlayer-controls",children:[Object(r.jsx)(p,{iconName:"do_not_disturb",isActivated:"none"===w,onClick:function(){return k("none")}}),Object(r.jsx)(p,{iconName:"blur_on",isActivated:"blur"===w,onClick:function(){return k("blur")}}),Object(r.jsx)(p,{iconName:"image",isActivated:"image"===w,onClick:function(){return k("image")}})]})]})},m=n(233),O=n(253);var h=function(){var e=Object(o.useState)(null),t=Object(f.a)(e,2),n=t[0],r=t[1];return Object(o.useEffect)((function(){function e(){return(e=Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Loading TensorFlow.js and BodyPix segmentation model"),e.next=3,O.a();case 3:return e.t0=r,e.next=6,m.a();case 6:e.t1=e.sent,(0,e.t0)(e.t1),console.log("TensorFlow.js and BodyPix loaded");case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),n};var v=function(){var e=h();return Object(o.useEffect)((function(){function e(){return(e=Object(l.a)(s.a.mark((function e(){var t,n,r,o,c,a,u,i,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,createTFLiteModule();case 2:return t=e.sent,e.next=5,fetch("".concat("/virtual-background","/models/segm_lite_v681.tflite"));case 5:return n=e.sent,e.next=8,n.arrayBuffer();case 8:return r=e.sent,console.log("Lite model buffer size:",r.byteLength),e.next=12,fetch("".concat("/virtual-background","/models/segm_full_v679.tflite"));case 12:return o=e.sent,e.next=15,o.arrayBuffer();case 15:c=e.sent,console.log("Full model buffer size:",c.byteLength),a=t._getModelBufferMemoryOffset(),console.log("Model buffer memory offset:",a),console.log("Loading light model buffer..."),t.HEAPU8.set(new Uint8Array(r),a),console.log("_loadModel result:",t._loadModel(r.byteLength)),console.log("Input memory offset:",t._getInputMemoryOffset()),console.log("Input height:",t._getInputHeight()),console.log("Input width:",t._getInputWidth()),console.log("Input channels:",t._getInputChannelCount()),console.log("Output memory offset:",t._getOutputMemoryOffset()),console.log("Output height:",t._getOutputHeight()),console.log("Output width:",t._getOutputWidth()),console.log("Output channels:",t._getOutputChannelCount()),u=Date.now(),i=t._runInference(),l=Date.now()-u,console.log("_runInference result: ".concat(i," (").concat(l,"ms)"));case 34:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),e&&Object(r.jsx)(j,{bodyPixNeuralNetwork:e})},x=(n(280),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,282)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,c=t.getLCP,a=t.getTTFB;n(e),r(e),o(e),c(e),a(e)}))});u.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(v,{})}),document.getElementById("root")),x()}},[[281,1,2]]]);
//# sourceMappingURL=main.5e9c4f39.chunk.js.map