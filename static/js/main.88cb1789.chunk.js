(this["webpackJsonpvirtual-background"]=this["webpackJsonpvirtual-background"]||[]).push([[0],{337:function(e,t){},338:function(e,t){},346:function(e,t){},349:function(e,t){},350:function(e,t){},351:function(e,t,n){"use strict";n.r(t);var a=n(22),r=n(401),o=n(6),i=n.n(o),c=n(52),u=n.n(c),s=n(58),l=n(5),f=n(394),d=n(404),g=n(396),b=n(397),m=n(354),p=n(288),j=n.n(p),h=n(289),v=n.n(h),O=n(4),x=n.n(O),C=n(12);function _(e,t,n){var a=Math.min(t,n),r=(t-a)/2,o=(n-a)/2,i=document.createElement("canvas");return i.width=63,i.height=63,i.getContext("2d").drawImage(e,r,o,a,a,0,0,i.width,i.height),new Promise((function(e){return i.toBlob((function(t){return e(t)}))}))}var E=function(e){var t=Object(o.useState)(),n=Object(l.a)(t,2),a=n[0],r=n[1];return Object(o.useEffect)((function(){var t=new Image;t.src=e,t.onload=Object(C.a)(x.a.mark((function e(){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(t,t.naturalWidth,t.naturalHeight);case 2:n=e.sent,r(URL.createObjectURL(n));case 4:case"end":return e.stop()}}),e)})))}),[e]),[a,function(){return URL.revokeObjectURL(a)}]},R=n(395),T=n(26),k=n(390);var F=Object(f.a)((function(e){return Object(d.a)({root:{padding:0,minWidth:e.spacing(7)+2,height:e.spacing(7)+2,width:e.spacing(7)+2,marginRight:e.spacing(1),marginBottom:e.spacing(1),border:"2px solid transparent",alignItems:"stretch",transitionProperty:"transform, border-color",transitionDuration:"".concat(e.transitions.duration.shorter,"ms"),transitionTimingFunction:e.transitions.easing.easeInOut,"&:hover":{transform:"scale(1.125)"}},active:{borderColor:e.palette.primary.main,transform:"scale(1.125)"}})})),y=function(e){var t=F();return Object(a.jsx)(k.a,{className:Object(T.a)(t.root,e.active&&t.active),disabled:e.disabled,onClick:e.onClick,children:e.children})};var S=Object(f.a)((function(e){return Object(d.a)({scalableContent:{width:"calc(100% + 2px)",height:"calc(100% + 2px)",margin:-1,borderRadius:e.shape.borderRadius},image:{objectFit:"cover"}})})),w=function(e){var t=S();return Object(a.jsxs)(y,{active:!!e.thumbnailUrl&&e.active,disabled:!e.thumbnailUrl,onClick:e.onClick,children:[e.thumbnailUrl?Object(a.jsx)("img",{className:Object(T.a)(t.scalableContent,t.image),src:e.thumbnailUrl,alt:"",onLoad:e.onLoad}):Object(a.jsx)(R.a,{className:t.scalableContent,variant:"rect"}),e.children]})};var A=function(e){var t=E(e.imageUrl),n=Object(l.a)(t,2),r=n[0],o=n[1];return Object(a.jsx)(w,{thumbnailUrl:r,active:e.active,onClick:e.onClick,onLoad:o})};var U=Object(f.a)((function(e){return Object(d.a)({root:{width:"100%",height:"100%",borderWidth:1,borderStyle:"solid",borderColor:"rgba(0, 0, 0, 0.23)",borderRadius:e.shape.borderRadius,margin:-1,boxSizing:"content-box",display:"flex",justifyContent:"center",alignItems:"center"}})})),P=function(e){var t=U();return Object(a.jsx)(y,{active:e.active,onClick:e.onClick,children:Object(a.jsx)("div",{className:t.root,children:e.children})})},M=["architecture-5082700_1280","porch-691330_1280","saxon-switzerland-539418_1280","shibuyasky-4768679_1280"].map((function(e){return"".concat("/virtual-background","/backgrounds/").concat(e,".jpg")}));var L=Object(f.a)((function(e){return Object(d.a)({root:{flex:1}})})),D=function(e){var t=L();return Object(a.jsx)(g.a,{className:t.root,children:Object(a.jsxs)(b.a,{children:[Object(a.jsx)(m.a,{gutterBottom:!0,variant:"h6",component:"h2",children:"Background"}),Object(a.jsx)(P,{active:"none"===e.config.type,onClick:function(){return e.onChange({type:"none"})},children:Object(a.jsx)(j.a,{})}),Object(a.jsx)(P,{active:"blur"===e.config.type,onClick:function(){return e.onChange({type:"blur"})},children:Object(a.jsx)(v.a,{})}),M.map((function(t){return Object(a.jsx)(A,{imageUrl:t,active:t===e.config.url,onClick:function(){return e.onChange({type:"image",url:t})}},t)}))]})})},B=n(51),I=n(398),W=n(399),N=n(406),H=n(407),X=n(402),G=n(405),V=n(403);var Y=Object(f.a)((function(e){return Object(d.a)({lightWrapping:{display:"flex",alignItems:"center"},formControl:{marginTop:e.spacing(2),marginBottom:e.spacing(1),marginRight:e.spacing(2),minWidth:160}})})),z=function(e){var t=Y();return Object(a.jsx)(g.a,{children:Object(a.jsxs)(b.a,{children:[Object(a.jsx)(m.a,{gutterBottom:!0,variant:"h6",component:"h2",children:"Post-processing"}),"webgl2"===e.pipeline?Object(a.jsxs)(i.a.Fragment,{children:[Object(a.jsx)(m.a,{gutterBottom:!0,children:"Joint bilateral filter"}),Object(a.jsx)(m.a,{variant:"body2",children:"Sigma space"}),Object(a.jsx)(G.a,{value:e.config.jointBilateralFilter.sigmaSpace,min:0,max:10,step:.1,valueLabelDisplay:"auto",onChange:function(t,n){e.onChange(Object(B.a)(Object(B.a)({},e.config),{},{jointBilateralFilter:Object(B.a)(Object(B.a)({},e.config.jointBilateralFilter),{},{sigmaSpace:n})}))}}),Object(a.jsx)(m.a,{variant:"body2",children:"Sigma color"}),Object(a.jsx)(G.a,{value:e.config.jointBilateralFilter.sigmaColor,min:0,max:1,step:.01,valueLabelDisplay:"auto",onChange:function(t,n){e.onChange(Object(B.a)(Object(B.a)({},e.config),{},{jointBilateralFilter:Object(B.a)(Object(B.a)({},e.config.jointBilateralFilter),{},{sigmaColor:n})}))}}),Object(a.jsx)(m.a,{gutterBottom:!0,children:"Background"}),Object(a.jsx)(m.a,{variant:"body2",children:"Coverage"}),Object(a.jsx)(G.a,{value:e.config.coverage,min:0,max:1,step:.01,valueLabelDisplay:"auto",onChange:function(t,n){e.onChange(Object(B.a)(Object(B.a)({},e.config),{},{coverage:n}))}}),Object(a.jsx)(m.a,{variant:"body2",gutterBottom:!0,children:"Light wrapping"}),Object(a.jsxs)("div",{className:t.lightWrapping,children:[Object(a.jsxs)(I.a,{className:t.formControl,variant:"outlined",children:[Object(a.jsx)(N.a,{children:"Blend mode"}),Object(a.jsxs)(X.a,{label:"Blend mode",value:e.config.blendMode,onChange:function(t){e.onChange(Object(B.a)(Object(B.a)({},e.config),{},{blendMode:t.target.value}))},children:[Object(a.jsx)(H.a,{value:"screen",children:"Screen"}),Object(a.jsx)(H.a,{value:"linearDodge",children:"Linear dodge"})]})]}),Object(a.jsx)(G.a,{value:e.config.lightWrapping,min:0,max:1,step:.01,valueLabelDisplay:"auto",onChange:function(t,n){e.onChange(Object(B.a)(Object(B.a)({},e.config),{},{lightWrapping:n}))}})]})]}):Object(a.jsx)(W.a,{label:"Smooth segmentation mask",control:Object(a.jsx)(V.a,{color:"primary",checked:e.config.smoothSegmentationMask,onChange:function(t){e.onChange(Object(B.a)(Object(B.a)({},e.config),{},{smoothSegmentationMask:t.target.checked}))}})})]})})};var q=Object(f.a)((function(e){return Object(d.a)({root:Object(s.a)({},e.breakpoints.only("md"),{gridColumnStart:2,gridRowStart:2}),formControls:{display:"flex",flexWrap:"wrap"},formControl:{marginTop:e.spacing(1),marginBottom:e.spacing(1),marginRight:e.spacing(2),minWidth:200,flex:1}})})),J=function(e){var t=q();return Object(a.jsx)(g.a,{className:t.root,children:Object(a.jsxs)(b.a,{children:[Object(a.jsx)(m.a,{gutterBottom:!0,variant:"h6",component:"h2",children:"Segmentation"}),Object(a.jsxs)("div",{className:t.formControls,children:[Object(a.jsxs)(I.a,{className:t.formControl,variant:"outlined",children:[Object(a.jsx)(N.a,{children:"Model"}),Object(a.jsxs)(X.a,{label:"Model",value:e.config.model,onChange:function(t){var n=t.target.value,a=e.config.backend,r=e.config.inputResolution;"meet"===n?(a="wasm","360p"===r&&(r="144p")):"bodyPix"===n&&(a="webgl",r="360p");var o=e.config.pipeline;"bodyPix"===n&&"webgl2"===o&&(o="canvas2dCpu"),e.onChange(Object(B.a)(Object(B.a)({},e.config),{},{model:n,backend:a,inputResolution:r,pipeline:o}))},children:[Object(a.jsx)(H.a,{value:"meet",children:"Meet"}),Object(a.jsx)(H.a,{value:"bodyPix",children:"BodyPix"})]})]}),Object(a.jsxs)(I.a,{className:t.formControl,variant:"outlined",children:[Object(a.jsx)(N.a,{children:"Backend"}),Object(a.jsxs)(X.a,{label:"Backend",value:e.config.backend,onChange:function(t){e.onChange(Object(B.a)(Object(B.a)({},e.config),{},{backend:t.target.value}))},children:[Object(a.jsx)(H.a,{value:"wasm",disabled:"bodyPix"===e.config.model,children:"WebAssembly"}),Object(a.jsx)(H.a,{value:"wasmSimd",disabled:"bodyPix"===e.config.model||!e.isSIMDSupported,children:"WebAssembly SIMD"}),Object(a.jsx)(H.a,{value:"webgl",disabled:"meet"===e.config.model,children:"WebGL"})]})]}),Object(a.jsxs)(I.a,{className:t.formControl,variant:"outlined",children:[Object(a.jsx)(N.a,{children:"Input resolution"}),Object(a.jsxs)(X.a,{label:"Input resolution",value:e.config.inputResolution,onChange:function(t){e.onChange(Object(B.a)(Object(B.a)({},e.config),{},{inputResolution:t.target.value}))},children:[Object(a.jsx)(H.a,{value:"360p",disabled:"meet"===e.config.model,children:"360p"}),Object(a.jsx)(H.a,{value:"144p",disabled:"bodyPix"===e.config.model,children:"144p"}),Object(a.jsx)(H.a,{value:"96p",disabled:"bodyPix"===e.config.model,children:"96p"})]})]}),Object(a.jsxs)(I.a,{className:t.formControl,variant:"outlined",children:[Object(a.jsx)(N.a,{children:"Pipeline"}),Object(a.jsxs)(X.a,{label:"Pipeline",value:e.config.pipeline,onChange:function(t){e.onChange(Object(B.a)(Object(B.a)({},e.config),{},{pipeline:t.target.value}))},children:[Object(a.jsx)(H.a,{value:"webgl2",disabled:"bodyPix"===e.config.model,children:"WebGL 2 (WIP)"}),Object(a.jsx)(H.a,{value:"canvas2dCpu",children:"Canvas 2D + CPU"})]})]})]})]})})},K=n(291),Q=n.n(K),Z=n(290),$=n.n(Z);var ee=function(e){var t=Object(o.useState)(),n=Object(l.a)(t,2),a=n[0],r=n[1];return Object(o.useEffect)((function(){var t=document.createElement("video");t.src=e,t.onloadedmetadata=function(){t.currentTime=t.duration/2},t.onseeked=Object(C.a)(x.a.mark((function e(){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(t,t.videoWidth,t.videoHeight);case 2:n=e.sent,r(URL.createObjectURL(n));case 4:case"end":return e.stop()}}),e)})))}),[e]),[a,function(){return URL.revokeObjectURL(a)}]};var te=Object(f.a)((function(e){return Object(d.a)({icon:{position:"absolute",bottom:0,right:0,color:e.palette.common.white}})})),ne=function(e){var t=te(),n=ee(e.videoUrl),r=Object(l.a)(n,2),o=r[0],i=r[1];return Object(a.jsx)(w,{thumbnailUrl:o,active:e.active,onClick:e.onClick,onLoad:i,children:Object(a.jsx)($.a,{className:t.icon})})},ae=["girl-919048_1280","doctor-5871743_640","woman-5883428_1280"].map((function(e){return"".concat("/virtual-background","/images/").concat(e,".jpg")})),re=["Dance - 32938","Doctor - 26732","Thoughtful - 35590"].map((function(e){return"".concat("/virtual-background","/videos/").concat(e,".mp4")}));var oe=Object(f.a)((function(e){return Object(d.a)({root:{flex:1}})})),ie=function(e){var t=oe();return Object(a.jsx)(g.a,{className:t.root,children:Object(a.jsxs)(b.a,{children:[Object(a.jsx)(m.a,{gutterBottom:!0,variant:"h6",component:"h2",children:"Source"}),Object(a.jsx)(P,{active:"camera"===e.config.type,onClick:function(){return e.onChange({type:"camera"})},children:Object(a.jsx)(Q.a,{})}),ae.map((function(t){return Object(a.jsx)(A,{imageUrl:t,active:t===e.config.url,onClick:function(){return e.onChange({type:"image",url:t})}},t)})),re.map((function(t){return Object(a.jsx)(ne,{videoUrl:t,active:t===e.config.url,onClick:function(){return e.onChange({type:"video",url:t})}},t)}))]})})},ce=n(408),ue=n(353),se={"360p":[640,360],"144p":[256,144],"96p":[160,96]};function le(e,t,n,a,r,o,i){var c=a.getContext("2d"),u=Object(l.a)(se[n.inputResolution],2),s=u[0],f=u[1],d=s*f,g=new ImageData(s,f),b=document.createElement("canvas");b.width=s,b.height=f;var m,p=b.getContext("2d"),j=o._getInputMemoryOffset()/4,h=o._getOutputMemoryOffset()/4;function v(){return(v=Object(C.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("none"!==t.type&&O(),i(),"none"===t.type){e.next=9;break}if("bodyPix"!==n.model){e.next=8;break}return e.next=6,_();case 6:e.next=9;break;case 8:R();case 9:i(),T();case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){if(p.drawImage(e.htmlElement,0,0,e.width,e.height,0,0,s,f),"meet"===n.model)for(var t=p.getImageData(0,0,s,f),a=0;a<d;a++)o.HEAPF32[j+3*a]=t.data[4*a]/255,o.HEAPF32[j+3*a+1]=t.data[4*a+1]/255,o.HEAPF32[j+3*a+2]=t.data[4*a+2]/255}function _(){return E.apply(this,arguments)}function E(){return(E=Object(C.a)(x.a.mark((function e(){var t,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.segmentPerson(b);case 2:for(t=e.sent,n=0;n<d;n++)g.data[4*n+3]=t.data[n]?255:0;p.putImageData(g,0,0);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(){o._runInference();for(var e=0;e<d;e++){var t=o.HEAPF32[h+2*e],n=o.HEAPF32[h+2*e+1],a=Math.max(t,n),r=Math.exp(t-a),i=Math.exp(n-a);g.data[4*e+3]=255*i/(r+i)}p.putImageData(g,0,0)}function T(){var n;c.globalCompositeOperation="copy",c.filter="none",(null===(n=m)||void 0===n?void 0:n.smoothSegmentationMask)&&("blur"===t.type?c.filter="blur(8px)":"image"===t.type&&(c.filter="blur(4px)")),"none"!==t.type&&(c.drawImage(b,0,0,s,f,0,0,e.width,e.height),c.globalCompositeOperation="source-in",c.filter="none"),c.drawImage(e.htmlElement,0,0),"blur"===t.type&&(c.globalCompositeOperation="destination-over",c.filter="blur(8px)",c.drawImage(e.htmlElement,0,0))}return{render:function(){return v.apply(this,arguments)},updatePostProcessingConfig:function(e){m=e},cleanUp:function(){}}}var fe=n(94),de=String.raw;function ge(e,t,n,a,r){var o=function(e,t,n){var a=e.createProgram();if(e.attachShader(a,t),e.attachShader(a,n),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Error("Could not link WebGL program: ".concat(e.getProgramInfoLog(a)));return a}(e,t,n),i=e.getAttribLocation(o,"a_position");e.enableVertexAttribArray(i),e.bindBuffer(e.ARRAY_BUFFER,a),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var c=e.getAttribLocation(o,"a_texCoord");return e.enableVertexAttribArray(c),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0),o}function be(e,t,n){var a=e.createShader(t);if(e.shaderSource(a,n),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))throw new Error("Could not compile shader: ".concat(e.getShaderInfoLog(a)));return a}function me(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.NEAREST,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.NEAREST,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,o),e.texStorage2D(e.TEXTURE_2D,1,t,n,a),i}function pe(){var e=Object(fe.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n    uniform sampler2D u_personMask;\n    uniform sampler2D u_background;\n    uniform vec2 u_coverage;\n    uniform float u_lightWrapping;\n    uniform float u_blendMode;\n\n    in vec2 v_texCoord;\n    in vec2 v_backgroundCoord;\n\n    out vec4 outColor;\n\n    vec3 screen(vec3 a, vec3 b) {\n      return 1.0 - (1.0 - a) * (1.0 - b);\n    }\n\n    vec3 linearDodge(vec3 a, vec3 b) {\n      return a + b;\n    }\n\n    void main() {\n      vec3 frameColor = texture(u_inputFrame, v_texCoord).rgb;\n      vec3 backgroundColor = texture(u_background, v_backgroundCoord).rgb;\n      float personMask = texture(u_personMask, v_texCoord).a;\n      float lightWrapMask = 1.0 - max(0.0, personMask - u_coverage.y) / (1.0 - u_coverage.y);\n      vec3 lightWrap = u_lightWrapping * lightWrapMask * backgroundColor;\n      frameColor = u_blendMode * linearDodge(frameColor, lightWrap) +\n        (1.0 - u_blendMode) * screen(frameColor, lightWrap);\n      personMask = smoothstep(u_coverage.x, u_coverage.y, personMask);\n      outColor = vec4(frameColor * personMask + backgroundColor * (1.0 - personMask), 1.0);\n    }\n  "]);return pe=function(){return e},e}function je(){var e=Object(fe.a)(["#version 300 es\n\n    uniform vec2 u_backgroundScale;\n    uniform vec2 u_backgroundOffset;\n\n    in vec2 a_position;\n    in vec2 a_texCoord;\n\n    out vec2 v_texCoord;\n    out vec2 v_backgroundCoord;\n\n    void main() {\n      // Flipping Y is required when rendering to canvas\n      gl_Position = vec4(a_position * vec2(1.0, -1.0), 0.0, 1.0);\n      v_texCoord = a_texCoord;\n      v_backgroundCoord = a_texCoord * u_backgroundScale + u_backgroundOffset;\n    }\n  "]);return je=function(){return e},e}function he(){var e=Object(fe.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n    uniform sampler2D u_segmentationMask;\n    uniform vec2 u_texelSize;\n    uniform float u_step;\n    uniform float u_radius;\n    uniform float u_offset;\n    uniform float u_sigmaTexel;\n    uniform float u_sigmaColor;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    float gaussian(float x, float sigma) {\n      float coeff = -0.5 / (sigma * sigma * 4.0 + 1.0e-6);\n      return exp((x * x) * coeff);\n    }\n\n    void main() {\n      vec2 centerCoord = v_texCoord;\n      vec3 centerColor = texture(u_inputFrame, centerCoord).rgb;\n      float newVal = 0.0;\n\n      float spaceWeight = 0.0;\n      float colorWeight = 0.0;\n      float totalWeight = 0.0;\n\n      // Subsample kernel space.\n      for (float i = -u_radius + u_offset; i <= u_radius; i += u_step) {\n        for (float j = -u_radius + u_offset; j <= u_radius; j += u_step) {\n          vec2 shift = vec2(j, i) * u_texelSize;\n          vec2 coord = vec2(centerCoord + shift);\n          vec3 frameColor = texture(u_inputFrame, coord).rgb;\n          float outVal = texture(u_segmentationMask, coord).a;\n\n          spaceWeight = gaussian(distance(centerCoord, coord), u_sigmaTexel);\n          colorWeight = gaussian(distance(centerColor, frameColor), u_sigmaColor);\n          totalWeight += spaceWeight * colorWeight;\n\n          newVal += spaceWeight * colorWeight * outVal;\n        }\n      }\n      newVal /= totalWeight;\n\n      outColor = vec4(vec3(0.0), newVal);\n    }\n  "]);return he=function(){return e},e}function ve(){var e=Object(fe.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    void main() {\n      outColor = texture(u_inputFrame, v_texCoord);\n    }\n  "]);return ve=function(){return e},e}function Oe(){var e=Object(fe.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputSegmentation;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    void main() {\n      vec2 segmentation = texture(u_inputSegmentation, v_texCoord).rg;\n      float shift = max(segmentation.r, segmentation.g);\n      float backgroundExp = exp(segmentation.r - shift);\n      float personExp = exp(segmentation.g - shift);\n      outColor = vec4(vec3(0.0), personExp / (backgroundExp + personExp));\n    }\n  "]);return Oe=function(){return e},e}function xe(){var e=Object(fe.a)(["#version 300 es\n\n    in vec2 a_position;\n    in vec2 a_texCoord;\n\n    out vec2 v_texCoord;\n\n    void main() {\n      gl_Position = vec4(a_position, 0.0, 1.0);\n      v_texCoord = a_texCoord;\n    }\n  "]);return xe=function(){return e},e}function Ce(e,t,n,a,r,o){var i=de(xe()),c=e.width,u=e.height,s=Object(l.a)(se[n.inputResolution],2),f=s[0],d=s[1],g=a.getContext("webgl2");g.getExtension("EXT_color_buffer_float");var b=be(g,g.VERTEX_SHADER,i),m=g.createVertexArray();g.bindVertexArray(m);var p=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,p),g.bufferData(g.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),g.STATIC_DRAW);var j=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,j),g.bufferData(g.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),g.STATIC_DRAW);var h=me(g,g.RGBA8,c,u),v=me(g,g.RGBA8,f,d),O=me(g,g.RGBA8,c,u),_=function(e,t,n,a,r,o){var i=de(ve()),c=o._getInputMemoryOffset()/4,u=Object(l.a)(se[r.inputResolution],2),s=u[0],f=u[1],d=s*f,g=be(e,e.FRAGMENT_SHADER,i),b=ge(e,t,g,n,a),m=e.getUniformLocation(b,"u_inputFrame"),p=me(e,e.RGBA32F,s,f),j=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,j),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,p,0);var h=new Float32Array(4*d);return e.useProgram(b),e.uniform1i(m,0),{render:function(){e.useProgram(b),e.bindFramebuffer(e.FRAMEBUFFER,j),e.viewport(0,0,s,f),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.readPixels(0,0,s,f,e.RGBA,e.FLOAT,h);for(var t=0;t<d;t++){var n=c+3*t,a=4*t;o.HEAPF32[n]=h[a],o.HEAPF32[n+1]=h[a+1],o.HEAPF32[n+2]=h[a+2]}},cleanUp:function(){e.deleteFramebuffer(j),e.deleteTexture(p),e.deleteProgram(b),e.deleteShader(g)}}}(g,b,p,j,n,r),E=function(e,t,n,a,r,o,i){var c=de(Oe()),u=o._getOutputMemoryOffset()/4,s=Object(l.a)(se[r.inputResolution],2),f=s[0],d=s[1],g=be(e,e.FRAGMENT_SHADER,c),b=ge(e,t,g,n,a),m=e.getUniformLocation(b,"u_inputSegmentation"),p=me(e,e.RG32F,f,d),j=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,j),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.useProgram(b),e.uniform1i(m,1),{render:function(){e.useProgram(b),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,p),e.texSubImage2D(e.TEXTURE_2D,0,0,0,f,d,e.RG,e.FLOAT,o.HEAPF32,u),e.bindFramebuffer(e.FRAMEBUFFER,j),e.viewport(0,0,f,d),e.drawArrays(e.TRIANGLE_STRIP,0,4)},cleanUp:function(){e.deleteFramebuffer(j),e.deleteTexture(p),e.deleteProgram(b),e.deleteShader(g)}}}(g,b,p,j,n,r,v),R=function(e,t,n,a,r,o,i,c){var u=de(he()),s=Object(l.a)(se[o.inputResolution],2),f=s[0],d=s[1],g=c.width,b=c.height,m=1/g,p=1/b,j=be(e,e.FRAGMENT_SHADER,u),h=ge(e,t,j,n,a),v=e.getUniformLocation(h,"u_inputFrame"),O=e.getUniformLocation(h,"u_segmentationMask"),x=e.getUniformLocation(h,"u_texelSize"),C=e.getUniformLocation(h,"u_step"),_=e.getUniformLocation(h,"u_radius"),E=e.getUniformLocation(h,"u_offset"),R=e.getUniformLocation(h,"u_sigmaTexel"),T=e.getUniformLocation(h,"u_sigmaColor"),k=e.createFramebuffer();function F(t){t*=Math.max(g/f,b/d);var n=Math.max(1,.66*Math.sqrt(t)),a=t,r=n>1?.5*n:0,o=Math.max(m,p)*t;e.useProgram(h),e.uniform1f(C,n),e.uniform1f(_,a),e.uniform1f(E,r),e.uniform1f(R,o)}function y(t){e.useProgram(h),e.uniform1f(T,t)}return e.bindFramebuffer(e.FRAMEBUFFER,k),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.useProgram(h),e.uniform1i(v,0),e.uniform1i(O,1),e.uniform2f(x,m,p),F(0),y(0),{render:function(){e.useProgram(h),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r),e.bindFramebuffer(e.FRAMEBUFFER,k),e.viewport(0,0,g,b),e.drawArrays(e.TRIANGLE_STRIP,0,4)},updateSigmaSpace:F,updateSigmaColor:y,cleanUp:function(){e.deleteFramebuffer(k),e.deleteProgram(h),e.deleteShader(j)}}}(g,b,p,j,v,n,O,a),T=function(e,t,n,a,r,o){var i=de(je()),c=de(pe()),u=o.width,s=o.height,l=u/s,f=be(e,e.VERTEX_SHADER,i),d=be(e,e.FRAGMENT_SHADER,c),g=ge(e,f,d,t,n),b=e.getUniformLocation(g,"u_backgroundScale"),m=e.getUniformLocation(g,"u_backgroundOffset"),p=e.getUniformLocation(g,"u_inputFrame"),j=e.getUniformLocation(g,"u_personMask"),h=e.getUniformLocation(g,"u_background"),v=e.getUniformLocation(g,"u_coverage"),O=e.getUniformLocation(g,"u_lightWrapping"),x=e.getUniformLocation(g,"u_blendMode");e.useProgram(g),e.uniform2f(b,1,1),e.uniform2f(m,0,0),e.uniform1i(p,0),e.uniform1i(j,1),e.uniform2f(v,0,1),e.uniform1f(O,0),e.uniform1f(x,0);var C=null;function _(t){C=me(e,e.RGBA8,t.naturalWidth,t.naturalHeight,e.LINEAR,e.LINEAR),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.naturalWidth,t.naturalHeight,e.RGBA,e.UNSIGNED_BYTE,t);var n=0,a=0,r=t.naturalWidth,o=t.naturalHeight;r/o<l?(o=r/l,a=(t.naturalHeight-o)/2):(r=o*l,n=(t.naturalWidth-r)/2);var i=r/t.naturalWidth,c=o/t.naturalHeight;n/=t.naturalWidth,a/=t.naturalHeight,e.uniform2f(b,i,c),e.uniform2f(m,n,a)}return(null===r||void 0===r?void 0:r.complete)?_(r):r&&(r.onload=function(){_(r)}),{render:function(){e.useProgram(g),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,a),null!==C&&(e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,C),e.uniform1i(h,2)),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,u,s),e.drawArrays(e.TRIANGLE_STRIP,0,4)},updateCoverage:function(t){e.useProgram(g),e.uniform2f(v,t[0],t[1])},updateLightWrapping:function(t){e.useProgram(g),e.uniform1f(O,t)},updateBlendMode:function(t){e.useProgram(g),e.uniform1f(x,"screen"===t?0:1)},cleanUp:function(){e.deleteTexture(C),e.deleteProgram(g),e.deleteShader(d),e.deleteShader(f)}}}(g,p,j,O,t,a);function k(){return(k=Object(C.a)(x.a.mark((function t(){return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:g.clearColor(0,0,0,0),g.clear(g.COLOR_BUFFER_BIT),g.activeTexture(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,h),g.texSubImage2D(g.TEXTURE_2D,0,0,0,c,u,g.RGBA,g.UNSIGNED_BYTE,e.htmlElement),g.bindVertexArray(m),_.render(),o(),r._runInference(),o(),E.render(),R.render(),T.render();case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return{render:function(){return k.apply(this,arguments)},updatePostProcessingConfig:function(e){R.updateSigmaSpace(e.jointBilateralFilter.sigmaSpace),R.updateSigmaColor(e.jointBilateralFilter.sigmaColor),T.updateCoverage(e.coverage),T.updateLightWrapping(e.lightWrapping),T.updateBlendMode(e.blendMode)},cleanUp:function(){T.cleanUp(),R.cleanUp(),E.cleanUp(),_.cleanUp(),g.deleteTexture(O),g.deleteTexture(v),g.deleteTexture(h),g.deleteBuffer(j),g.deleteBuffer(p),g.deleteVertexArray(m),g.deleteShader(b)}}}var _e=function(){var e=Object(o.useState)(0),t=Object(l.a)(e,2),n=t[0],a=t[1],r=Object(o.useState)([]),i=Object(l.a)(r,2),c=i[0],u=i[1],s=Object(o.useRef)(0),f=Object(o.useRef)(0),d=Object(o.useRef)([]),g=Object(o.useRef)(0),b=Object(o.useRef)(0);return{fps:n,durations:c,beginFrame:Object(o.useCallback)((function(){f.current=Date.now()}),[]),addFrameEvent:Object(o.useCallback)((function(){var e=Date.now();d.current[g.current]=e-f.current,f.current=e,g.current++}),[]),endFrame:Object(o.useCallback)((function(){var e=Date.now();d.current[g.current]=e-f.current,b.current++,e>=s.current+1e3&&(a(1e3*b.current/(e-s.current)),u(d.current),s.current=e,b.current=0),g.current=0}),[])}};var Ee=function(e,t,n,a,r){var i=Object(o.useState)(null),c=Object(l.a)(i,2),u=c[0],s=c[1],f=Object(o.useRef)(null),d=Object(o.useRef)(null),g=_e(),b=g.fps,m=g.durations,p=g.beginFrame,j=g.addFrameEvent,h=g.endFrame;return Object(o.useEffect)((function(){var o,i=!0,c="webgl2"===n.pipeline?Ce(e,f.current,n,d.current,r,j):le(e,t,n,d.current,a,r,j);function u(){return l.apply(this,arguments)}function l(){return(l=Object(C.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return");case 2:return p(),e.next=5,c.render();case 5:h(),o=requestAnimationFrame(u);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return u(),console.log("Animation started:",e,t,n),s(c),function(){i=!1,cancelAnimationFrame(o),c.cleanUp(),console.log("Animation stopped:",e,t,n),s(null)}}),[e,t,n,a,r,s,p,j,h]),{pipeline:u,backgroundImageRef:f,canvasRef:d,fps:b,durations:m}};var Re=Object(f.a)((function(e){return Object(d.a)({root:{flex:1,position:"relative"},render:{position:"absolute",width:"100%",height:"100%",objectFit:"cover"},stats:{position:"absolute",top:0,right:0,left:0,textAlign:"center",backgroundColor:"rgba(0, 0, 0, 0.48)",color:e.palette.common.white}})})),Te=function(e){var t=Re(),n=Ee(e.sourcePlayback,e.backgroundConfig,e.segmentationConfig,e.bodyPix,e.tflite),r=n.pipeline,i=n.backgroundImageRef,c=n.canvasRef,u=n.fps,s=Object(l.a)(n.durations,3),f=s[0],d=s[1],g=s[2];Object(o.useEffect)((function(){r&&r.updatePostProcessingConfig(e.postProcessingConfig)}),[r,e.postProcessingConfig]);var b=["resizing ".concat(f,"ms"),"inference ".concat(d,"ms"),"post-processing ".concat(g,"ms")],p="".concat(Math.round(u)," fps (").concat(b.join(", "),")");return Object(a.jsxs)("div",{className:t.root,children:["image"===e.backgroundConfig.type&&Object(a.jsx)("img",{ref:i,className:t.render,src:e.backgroundConfig.url,alt:"",hidden:"webgl2"===e.segmentationConfig.pipeline}),Object(a.jsx)("canvas",{ref:c,className:t.render,width:e.sourcePlayback.width,height:e.sourcePlayback.height},e.segmentationConfig.pipeline),Object(a.jsx)(m.a,{className:t.stats,variant:"caption",children:p})]})},ke=n(400),Fe=n(292),ye=n.n(Fe);var Se=Object(f.a)((function(e){var t;return Object(d.a)({root:(t={position:"relative",display:"flex",justifyContent:"center",alignItems:"center"},Object(s.a)(t,e.breakpoints.down("xs"),{width:0,overflow:"hidden"}),Object(s.a)(t,e.breakpoints.up("sm"),{flex:1,borderRightWidth:1,borderRightStyle:"solid",borderRightColor:e.palette.divider}),t),sourcePlayback:{position:"absolute",width:"100%",height:"100%",objectFit:"cover"}})})),we=function(e){var t=Se(),n=Object(o.useState)(),r=Object(l.a)(n,2),i=r[0],c=r[1],u=Object(o.useState)(!1),s=Object(l.a)(u,2),f=s[0],d=s[1],g=Object(o.useState)(!1),b=Object(l.a)(g,2),m=b[0],p=b[1],j=Object(o.useRef)(null);return Object(o.useEffect)((function(){c(void 0),d(!0),p(!1),setTimeout((function(){return c(e.sourceConfig.url)}))}),[e.sourceConfig]),Object(o.useEffect)((function(){function t(){return(t=Object(C.a)(x.a.mark((function e(){var t,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={video:!0},e.next=4,navigator.mediaDevices.getUserMedia(t);case 4:if(n=e.sent,!j.current){e.next=8;break}return j.current.srcObject=n,e.abrupt("return");case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Error opening video camera.",e.t0);case 13:d(!1),p(!0);case 15:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}"camera"===e.sourceConfig.type?function(){t.apply(this,arguments)}():j.current&&(j.current.srcObject=null)}),[e.sourceConfig]),Object(a.jsxs)("div",{className:t.root,children:[f&&Object(a.jsx)(ke.a,{}),"image"===e.sourceConfig.type?Object(a.jsx)("img",{className:t.sourcePlayback,src:i,hidden:f,alt:"",onLoad:function(t){var n=t.target;e.onLoad({htmlElement:n,width:n.naturalWidth,height:n.naturalHeight}),d(!1)}}):m?Object(a.jsx)(ye.a,{fontSize:"large"}):Object(a.jsx)("video",{ref:j,className:t.sourcePlayback,src:i,hidden:f,autoPlay:!0,playsInline:!0,controls:!1,muted:!0,loop:!0,onLoadedData:function(t){var n=t.target;e.onLoad({htmlElement:n,width:n.videoWidth,height:n.videoHeight}),d(!1)}})]})};var Ae=Object(f.a)((function(e){var t,n=["".concat(e.spacing(52),"px"),"100vh - ".concat(e.spacing(2),"px")];return Object(d.a)({root:(t={minHeight:"calc(min(".concat(n.join(", "),"))"),display:"flex",overflow:"hidden"},Object(s.a)(t,e.breakpoints.up("md"),{gridColumnStart:1,gridColumnEnd:3}),Object(s.a)(t,e.breakpoints.up("lg"),{gridRowStart:1,gridRowEnd:3}),t),noOutput:{flex:1,display:"flex",justifyContent:"center",alignItems:"center"},avatar:{width:e.spacing(20),height:e.spacing(20)}})})),Ue=function(e){var t=Ae(),n=Object(o.useState)(),r=Object(l.a)(n,2),i=r[0],c=r[1];return Object(o.useEffect)((function(){c(void 0)}),[e.sourceConfig]),Object(a.jsxs)(ue.a,{className:t.root,children:[Object(a.jsx)(we,{sourceConfig:e.sourceConfig,onLoad:c}),i&&e.bodyPix&&e.tflite?Object(a.jsx)(Te,{sourcePlayback:i,backgroundConfig:e.backgroundConfig,segmentationConfig:e.segmentationConfig,postProcessingConfig:e.postProcessingConfig,bodyPix:e.bodyPix,tflite:e.tflite}):Object(a.jsx)("div",{className:t.noOutput,children:Object(a.jsx)(ce.a,{className:t.avatar})})]})},Pe=n(293),Me=n(313);var Le=function(){var e=Object(o.useState)(),t=Object(l.a)(e,2),n=t[0],a=t[1];return Object(o.useEffect)((function(){function e(){return(e=Object(C.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Loading TensorFlow.js and BodyPix segmentation model"),e.next=3,Me.a();case 3:return e.t0=a,e.next=6,Pe.a();case 6:e.t1=e.sent,(0,e.t0)(e.t1),console.log("TensorFlow.js and BodyPix loaded");case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),n};var De=function(e){var t=Object(o.useState)(),n=Object(l.a)(t,2),a=n[0],r=n[1],i=Object(o.useState)(),c=Object(l.a)(i,2),u=c[0],s=c[1],f=Object(o.useState)(),d=Object(l.a)(f,2),g=d[0],b=d[1],m=Object(o.useState)(!1),p=Object(l.a)(m,2),j=p[0],h=p[1];return Object(o.useEffect)((function(){function e(){return(e=Object(C.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return createTFLiteModule().then(r),e.prev=1,e.next=4,createTFLiteSIMDModule();case 4:t=e.sent,s(t),h(!0),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.warn("Failed to create TFLite SIMD WebAssembly module.",e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(o.useEffect)((function(){function t(){return(t=Object(C.a)(x.a.mark((function t(){var n,r,o,i,c;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a&&(!j||u)&&(j||"wasmSimd"!==e.backend)&&"meet"===e.model){t.next=2;break}return t.abrupt("return");case 2:if(b(void 0),n="wasmSimd"===e.backend?u:a){t.next=6;break}throw new Error("TFLite backend unavailable: ".concat(e.backend));case 6:return r="144p"===e.inputResolution?"segm_full_v679":"segm_lite_v681",console.log("Loading meet model:",r),t.next=10,fetch("".concat("/virtual-background","/models/").concat(r,".tflite"));case 10:return o=t.sent,t.next=13,o.arrayBuffer();case 13:i=t.sent,console.log("Model buffer size:",i.byteLength),c=n._getModelBufferMemoryOffset(),console.log("Model buffer memory offset:",c),console.log("Loading model buffer..."),n.HEAPU8.set(new Uint8Array(i),c),console.log("_loadModel result:",n._loadModel(i.byteLength)),console.log("Input memory offset:",n._getInputMemoryOffset()),console.log("Input height:",n._getInputHeight()),console.log("Input width:",n._getInputWidth()),console.log("Input channels:",n._getInputChannelCount()),console.log("Output memory offset:",n._getOutputMemoryOffset()),console.log("Output height:",n._getOutputHeight()),console.log("Output width:",n._getOutputWidth()),console.log("Output channels:",n._getOutputChannelCount()),b(n);case 29:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[a,u,j,e.model,e.backend,e.inputResolution]),{tflite:g,isSIMDSupported:j}};var Be=Object(f.a)((function(e){var t;return Object(d.a)({root:(t={display:"grid"},Object(s.a)(t,e.breakpoints.up("xs"),{margin:e.spacing(1),gap:e.spacing(1),gridTemplateColumns:"1fr"}),Object(s.a)(t,e.breakpoints.up("md"),{margin:e.spacing(2),gap:e.spacing(2),gridTemplateColumns:"repeat(2, 1fr)"}),Object(s.a)(t,e.breakpoints.up("lg"),{gridTemplateColumns:"repeat(3, 1fr)"}),t),resourceSelectionCards:{display:"flex",flexDirection:"column"}})})),Ie=function(){var e=Be(),t=Object(o.useState)({type:"image",url:ae[0]}),n=Object(l.a)(t,2),r=n[0],i=n[1],c=Object(o.useState)({type:"image",url:M[0]}),u=Object(l.a)(c,2),s=u[0],f=u[1],d=Object(o.useState)({model:"meet",backend:"wasm",inputResolution:"96p",pipeline:"canvas2dCpu"}),g=Object(l.a)(d,2),b=g[0],m=g[1],p=Object(o.useState)({smoothSegmentationMask:!0,jointBilateralFilter:{sigmaSpace:1,sigmaColor:.1},coverage:[.5,.75],lightWrapping:.3,blendMode:"screen"}),j=Object(l.a)(p,2),h=j[0],v=j[1],O=Le(),x=De(b),C=x.tflite,_=x.isSIMDSupported;return Object(a.jsxs)("div",{className:e.root,children:[Object(a.jsx)(Ue,{sourceConfig:r,backgroundConfig:s,segmentationConfig:b,postProcessingConfig:h,bodyPix:O,tflite:C}),Object(a.jsx)(ie,{config:r,onChange:i}),Object(a.jsx)(D,{config:s,onChange:f}),Object(a.jsx)(J,{config:b,isSIMDSupported:_,onChange:m}),Object(a.jsx)(z,{config:h,pipeline:b.pipeline,onChange:v})]})},We=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,409)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),o(e),i(e)}))};u.a.render(Object(a.jsxs)(i.a.StrictMode,{children:[Object(a.jsx)(r.a,{}),Object(a.jsx)(Ie,{})]}),document.getElementById("root")),We()}},[[351,1,2]]]);
//# sourceMappingURL=main.88cb1789.chunk.js.map